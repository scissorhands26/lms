# Malware Basics

Malware, short for malicious software, is intentionally designed to be hostile and intrusive. It seeks to invade, damage, or disable computers, computer systems, or networks.

## Goals of malware:

- **Steal Data**: Collect private data for personal gain or to harm an organization.
- **Manipulate Data**: Encrypt data in order to demand ransom or alter sensitive information.
- **Disrupt Systems**: Disrupt the system's functionality to inflict damage or financial loss.
- **Co-opt System** Hyjack the system for use in botnet or cryptomining.

## Types

- **Viruses**: Self-replicates by modifying other programs and infecting them with its own code
- **Worm**: Self-replicates and can spread across the system on its own
- **Trojans**: Disguise as legitimate processes
- **Botnets**: Groups of infected devices that perform a task
- **Rootkits**: Malware that hides it's presence by modifying system files or processes
- **Spyware**: Collections information about user activities
- **Adware**: Displays unwanted advertisements or redirects users to promotional content
- **Ransomware**: Encrypts file and demands payment for their release
- **Cryptominer**: Uses someone elses computer to mine crypto for financial gain

## Characteristics

- **Polymorphism**: This refers to malware that can repeatedly mutate its appearance or signature files through new decryption routines, making it difficult for traditional cybersecurity tools to recognize and block the threat.

- **Obfuscation**: Obfuscation is a technique used by cybercriminals to make the code of a program hard to discover or understand—by both humans and computers—but without changing how the program works. The goal is not just to make a program unreadable, but to hide its presence completely.

- **Persistence**: Persistence refers to the malware’s ability to maintain its presence on a system even after a reboot. It often achieves this by creating registry entries or modifying system files to ensure it is run at each system startup.

- **Process Injection**: Process injection is a method of executing arbitrary code in the address space of a separate live process. Running code in the context of another process may allow access to the process’s memory, system/network resources, and possibly elevated privileges.

- **Code Execution**: Code execution in cybersecurity refers to the ability of malicious code to run on a system without the user’s consent or knowledge. This can result in a variety of attacks, including malware infections, data theft, and remote access to the compromised system.

- **Data Exfiltration**: Data exfiltration occurs when malware and/or a malicious actor carries out an unauthorized data transfer from a computer. It is also commonly called data extrusion or data exportation. Data exfiltration is also considered a form of data theft.

- **Encryption**: An encrypted virus is a computer malware that’s capable of encrypting its payload to make its detection hard. Ransomware and Crypren are examples of the encrypted virus which encrypts victim’s files.

- **Stealth**: Stealth in malware refers to techniques used to hide the presence of malware or malicious activity on a system. This can involve techniques like rootkits, which hide malware processes and files, or anti-debugging techniques that prevent analysis of the malware.

- **Propagation**: This refers to the methods that malware uses to spread to other systems. This can involve self-replication, like worms, or other methods like exploiting vulnerabilities, email attachments, or malicious web downloads.

- **Evasion**: Evasion techniques are used by malware to avoid detection by security software. This can involve techniques like polymorphism and obfuscation, as well as others like sandbox detection, where the malware alters its behavior if it detects it’s running in a security sandbox.

- **MitM,MitB,Keylogger**:

## Malware Analysis

### Indicators of Compromise

- **Processes**: Unusual processes running on a system can be an indicator of a malware infection. This could include processes that are not typically seen on the system, processes that are using a large amount of system resources, or processes that are making unusual system calls.

- **Files**: File-based IOCs are indicators that suggest the presence of malicious files or malware on a system. These can include things like file hashes, filenames, and file paths. File-based IOCs can be detected through various file-scanning tools.

- **Network Traffic**: Network IOCs are indicators that suggest suspicious activity on a network. These can include unusual traffic patterns, connections to known malicious IP addresses or domains, and unexpected protocols or ports being used.

- **System Logs**: System logs can contain traces of malicious activity. This could include entries related to failed login attempts, changes to system configuration, or unusual network connections. Analyzing system logs is a common method for detecting and investigating security incidents.

- **Kernel Modules**: Malicious kernel modules can be an indicator of a rootkit or other types of kernel-level malware. These modules can modify the behavior of the operating system, hide the presence of malware, or provide the malware with elevated privileges.

- **Service/Scripts**: Malicious services or scripts running on a system can be an indicator of compromise. This could include services that are not typically present on the system, services that are configured to start automatically, or scripts that are scheduled to run at specific times.

- **User Accounts**: Unexpected user accounts can be an indicator of compromise. This could include accounts that were not created by the system administrator, accounts with unusual privileges, or accounts that are being used at unusual times.

### Static Analysis

This involves examining the malware without executing the code. This method allows you to inspect the inner workings of an application by analyzing its code, resources, and binary level properties. Tools used for this type of analysis won’t execute the code, instead, they will attempt to pull out suspicious indicators such as hashes, strings, imports and attempt to identify if the malware is packed.

Some tools for static analysis include:

- **file**: The file command in Linux is a standard program of Unix and Unix-like operating systems for recognizing the type of data contained in a computer file.
- **strings**: Extracts strings from a binary or non-text file by searching for readable characters.
- **objdump**: Program for displaying various information about object files on Unix-like operating systems.
- **debugger**: A debugger or debugging tool is a computer program used to test and debug other programs.
- **disassembler**: A disassembler is a computer program that translates machine language into assembly language —the inverse operation to that of an assembler.

### Dynamic Analysis

Dynamic malware analysis involves executing the malware in a controlled environment (like a sandbox) and observing its behavior. This allows security professionals to watch the malware in action without the risk of letting it infect their system or escape into the enterprise network.

Some tools for dynamic analysis include:

- **ps**: Display information about running processes.
- **ss**: Display socket information.
- **netstat**: Display network connections.
- **strace**: Displays system calls made by a program.
- **lsof**: Displays open files and the processes that are holding them open.
- **Sysinternals Suite**: Advanced system utilites offered by Microsoft.

### Network Analysis

Network analysis refers to the process of identifying, analyzing, and understanding the behavior of malicious network traffic generated by malware or other cyber threats. This involves examining network packets, protocols, and other metadata to identify patterns of suspicious or malicious activity.

Some tools for network analysis include:

- **tcpdump**: Display TCP/IP and other packets being transmitted or received over a network to which the computer is attached.
- **wireshark**: Network protocol analyzer, or an application that captures packets from a network connection.
- **Fiddler**: Web debugging proxy which logs all HTTP(S) traffic between your computer and the Internet. It allows you to inspect, debug, and performance test all the network traffic that is sent or received by your system

## Command and Contol

A Command and Control (C2) server is a central server used by attackers to distribute malware to people’s machines, execute commands to the malicious program, and take control of a device. It’s the set of tools and techniques that attackers use to maintain communication with compromised devices following initial exploitation.

- **Application Layer Protocols**: C2 servers might communicate using application layer protocols to avoid detection by blending in. Examples include web, file transfer, and mail protocols.

- **Proxy/Tunneling**: Adversaries might use proxies or tunnel through victim systems within to avoid detection and obfuscate their infrastructure.

- **Traffic Signaling**: Malware might use signaling to hide open ports used for persistence or command and control. An example of this is port knocking, where an adversary or C2 server sends a sequence of predefined connections to closed ports in order to have the malware open a port.

## Malware Examples

### Mirai Botnet

Mirai is a self-propagating botnet virus. The malware primarily targets online consumer devices such as IP cameras and home routers.
[Mirai Botnet](https://www.cloudflare.com/learning/ddos/glossary/mirai-botnet/)

### Emotet Trojan

Emotet is a Trojan that is primarily spread through spam emails. Once infected, it attempts to proliferate within a network by brute-forcing user credentials and writing to shared drives.

[Emotet Trojan](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan:Win32/Emotet)

### Petya Ransomware

Petya is a family of encrypting ransomware that was first discovered in 2016. A variant of Petya, NotPetya, was used for a global cyberattack in June 2017.
[Petya Ransomeware](https://www.malwarebytes.com/petya-and-notpetya)
